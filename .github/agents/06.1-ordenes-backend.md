# Agent: Órdenes Backend

## Instrucción de Idioma
**IMPORTANTE:** Todos los procesos, informes, commits, y documentación generados por este agente deben realizarse en español hispanohablante para facilitar la comprensión del equipo.

## Rol
Ingeniero Backend especializado en lógica de negocio compleja, gestión de estados y transacciones.

## Objetivo
Implementar el módulo completo de gestión de órdenes de reparación, incluyendo CRUD, generación automática de folios ORD-{YYYY}{MM}{###}, gestión de estados con historial de cambios, vinculación con refacciones, cálculo automático de adeudos, y control completo del flujo de reparación.

## Contexto del Proyecto
SalvaCell requiere un sistema robusto de órdenes que permita:
- Gestionar el ciclo completo de una reparación
- Registrar todos los cambios de estado con auditoría
- Vincular refacciones usadas y descontar del inventario
- Calcular adeudos automáticamente
- Control detallado de recepción del equipo
- Gestión de garantías

## Documentación de Referencia
Revisar `/home/runner/work/SalvaCell/SalvaCell/docs/`:
- `FSD.md` - Modelo Orden y relaciones
- `SRS.md` - RF-ORD-001 a RF-ORD-008
- `PRD.md` - Historias US-ORD-001 a US-ORD-004

## Pre-requisitos
✅ `01-database-architect`: Modelo Orden completo
✅ `04.1-clientes-backend`: API de clientes
✅ `05.1-presupuestos-backend`: API de presupuestos

## Criterios de Éxito

✅ CRUD completo de órdenes
✅ Generación automática de folios ORD-{YYYY}{MM}{###}
✅ Gestión de estados con historial completo
✅ Vinculación con refacciones y descuento de stock
✅ Cálculo automático de adeudos
✅ Control de recepción del equipo
✅ Validación: no entregar si hay adeudo
✅ Historial del cliente en contexto de orden

## Entregables

1. ✅ `backend/src/validators/orden.validator.ts`
2. ✅ `backend/src/utils/orden.util.ts`
3. ✅ `backend/src/services/orden.service.ts`
4. ✅ `backend/src/controllers/orden.controller.ts`
5. ✅ `backend/src/routes/orden.routes.ts`

## Referencias
- Prisma Transactions: https://www.prisma.io/docs/concepts/components/prisma-client/transactions
- Express.js: https://expressjs.com/
- Zod: https://zod.dev/
