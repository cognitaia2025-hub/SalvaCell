# Agent: Clientes Frontend

## Instrucción de Idioma
**IMPORTANTE:** Todos los procesos, informes, commits, y documentación generados por este agente deben realizarse en español hispanohablante para facilitar la comprensión del equipo.

## Rol
Ingeniero Frontend especializado en React, TypeScript, Tailwind CSS y shadcn/ui.

## Objetivo
Implementar la interfaz de usuario completa para el módulo de clientes, incluyendo lista con búsqueda, perfil del cliente, timeline de reparaciones, componente de búsqueda inteligente y UI para fusión de duplicados.

## Contexto del Proyecto
SalvaCell requiere una interfaz intuitiva y rápida para gestionar clientes que permita:
- Búsqueda instantánea de clientes
- Vista de lista con badges visuales (VIP/Frecuente/Nuevo)
- Perfil completo con estadísticas y métricas
- Timeline visual de todas las reparaciones
- Detección y fusión de duplicados con interfaz clara

## Documentación de Referencia
Revisar los siguientes documentos en la carpeta `/home/runner/work/SalvaCell/SalvaCell/docs/`:
- `FSD.md` - Sección 2.1 (Stack Frontend) y Sección 5 (UI/UX)
- `PRD.md` - Historias de usuario de clientes
- `BRD.md` - Requisitos de UX para clientes

## Pre-requisitos
✅ El agente `04.1-clientes-backend` debe haber completado:
  - API de clientes funcionando
  - Endpoints de búsqueda, estadísticas, duplicados y fusión

✅ Debe existir:
  - Proyecto React con Vite configurado
  - Tailwind CSS instalado
  - shadcn/ui components disponibles
  - React Router configurado
  - Zustand para state management

## Tareas Específicas

### 1. Instalar Dependencias Necesarias

```bash
cd frontend

# Shadcn/ui components (si no están instalados)
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add card
npx shadcn-ui@latest add badge
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add table
npx shadcn-ui@latest add select
npx shadcn-ui@latest add avatar
npx shadcn-ui@latest add separator
npx shadcn-ui@latest add tabs
npx shadcn-ui@latest add alert
npx shadcn-ui@latest add skeleton

# Otras dependencias
npm install react-hook-form @hookform/resolvers zod
npm install axios
npm install date-fns
npm install lucide-react
npm install zustand
```

### 2. Crear Tipos de TypeScript

**Archivo:** `frontend/src/types/cliente.ts`

```typescript
export type BadgeCliente = 'VIP' | 'FRECUENTE' | 'NUEVO';

export interface Cliente {
  id: string;
  nombre: string;
  apellido: string;
  telefono: string;
  telefonoAlterno?: string | null;
  email?: string | null;
  direccion?: string | null;
  notas?: string | null;
  createdAt: string;
  updatedAt: string;
}

export interface EstadisticasCliente {
  totalOrdenes: number;
  totalGastado: number;
  ticketPromedio: number;
  adeudoPendiente: number;
  clv: number;
  frecuenciaVisitas: number;
  badge: BadgeCliente;
}

export interface AlertaCliente {
  tipo: 'ADEUDO' | 'ORDENES_PENDIENTES' | 'GARANTIAS_ACTIVAS';
  mensaje: string;
  ordenes?: Array<{
    folio: string;
    estado: string;
  }>;
  garantias?: Array<{
    folio: string;
    vencimiento: string;
  }>;
}

export interface ClienteConEstadisticas extends Cliente {
  estadisticas: EstadisticasCliente;
  ordenes?: any[];
  equipos?: any[];
  ventas?: any[];
  alertas?: AlertaCliente[];
}

export interface DuplicadoCliente {
  cliente1: {
    id: string;
    nombre: string;
    telefono: string;
  };
  cliente2: {
    id: string;
    nombre: string;
    telefono: string;
  };
  similitudNombre: number;
  telefonosIguales: boolean;
}
```

### 3. Crear Servicio API para Clientes

**Archivo:** `frontend/src/services/clienteService.ts`

```typescript
import axios from 'axios';
import { Cliente, ClienteConEstadisticas, DuplicadoCliente } from '@/types/cliente';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';

export const clienteService = {
  // Obtener lista de clientes con búsqueda
  async getClientes(params?: { search?: string; page?: number; limit?: number }) {
    const { data } = await axios.get(`${API_URL}/api/clientes`, { params });
    return data.data;
  },

  // Obtener cliente por ID
  async getClienteById(id: string): Promise<ClienteConEstadisticas> {
    const { data } = await axios.get(`${API_URL}/api/clientes/${id}`);
    return data.data;
  },

  // Crear cliente
  async createCliente(cliente: Partial<Cliente>): Promise<Cliente> {
    const { data } = await axios.post(`${API_URL}/api/clientes`, cliente);
    return data.data;
  },

  // Actualizar cliente
  async updateCliente(id: string, cliente: Partial<Cliente>): Promise<Cliente> {
    const { data } = await axios.put(`${API_URL}/api/clientes/${id}`, cliente);
    return data.data;
  },

  // Eliminar cliente
  async deleteCliente(id: string) {
    const { data } = await axios.delete(`${API_URL}/api/clientes/${id}`);
    return data.data;
  },

  // Detectar duplicados
  async detectarDuplicados(): Promise<DuplicadoCliente[]> {
    const { data } = await axios.get(`${API_URL}/api/clientes/duplicados/detectar`);
    return data.data;
  },

  // Fusionar clientes
  async fusionarClientes(clienteIdPrincipal: string, clienteIdDuplicado: string) {
    const { data } = await axios.post(`${API_URL}/api/clientes/fusionar`, {
      clienteIdPrincipal,
      clienteIdDuplicado,
    });
    return data.data;
  },

  // Obtener historial de órdenes
  async getHistorialOrdenes(clienteId: string) {
    const { data } = await axios.get(`${API_URL}/api/clientes/${clienteId}/historial`);
    return data.data;
  },

  // Obtener equipos del cliente
  async getEquiposCliente(clienteId: string) {
    const { data } = await axios.get(`${API_URL}/api/clientes/${clienteId}/equipos`);
    return data.data;
  },
};
```

### 4. Crear Store de Zustand para Clientes

**Archivo:** `frontend/src/stores/clienteStore.ts`

```typescript
import { create } from 'zustand';
import { Cliente, ClienteConEstadisticas } from '@/types/cliente';
import { clienteService } from '@/services/clienteService';

interface ClienteState {
  clientes: Cliente[];
  clienteSeleccionado: ClienteConEstadisticas | null;
  isLoading: boolean;
  error: string | null;
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
  };
  
  // Actions
  fetchClientes: (params?: { search?: string; page?: number; limit?: number }) => Promise<void>;
  fetchClienteById: (id: string) => Promise<void>;
  createCliente: (cliente: Partial<Cliente>) => Promise<Cliente>;
  updateCliente: (id: string, cliente: Partial<Cliente>) => Promise<void>;
  deleteCliente: (id: string) => Promise<void>;
  clearClienteSeleccionado: () => void;
}

export const useClienteStore = create<ClienteState>((set, get) => ({
  clientes: [],
  clienteSeleccionado: null,
  isLoading: false,
  error: null,
  pagination: {
    page: 1,
    limit: 20,
    total: 0,
    totalPages: 0,
  },
  
  fetchClientes: async (params) => {
    set({ isLoading: true, error: null });
    try {
      const result = await clienteService.getClientes(params);
      set({
        clientes: result.clientes,
        pagination: result.pagination,
        isLoading: false,
      });
    } catch (error: any) {
      set({ error: error.message, isLoading: false });
    }
  },
  
  fetchClienteById: async (id) => {
    set({ isLoading: true, error: null });
    try {
      const cliente = await clienteService.getClienteById(id);
      set({ clienteSeleccionado: cliente, isLoading: false });
    } catch (error: any) {
      set({ error: error.message, isLoading: false });
    }
  },
  
  createCliente: async (cliente) => {
    set({ isLoading: true, error: null });
    try {
      const nuevoCliente = await clienteService.createCliente(cliente);
      set({ isLoading: false });
      return nuevoCliente;
    } catch (error: any) {
      set({ error: error.message, isLoading: false });
      throw error;
    }
  },
  
  updateCliente: async (id, cliente) => {
    set({ isLoading: true, error: null });
    try {
      await clienteService.updateCliente(id, cliente);
      set({ isLoading: false });
      // Re-fetch para actualizar la lista
      get().fetchClientes();
    } catch (error: any) {
      set({ error: error.message, isLoading: false });
      throw error;
    }
  },
  
  deleteCliente: async (id) => {
    set({ isLoading: true, error: null });
    try {
      await clienteService.deleteCliente(id);
      set({ isLoading: false });
      // Re-fetch para actualizar la lista
      get().fetchClientes();
    } catch (error: any) {
      set({ error: error.message, isLoading: false });
      throw error;
    }
  },
  
  clearClienteSeleccionado: () => {
    set({ clienteSeleccionado: null });
  },
}));
```

### 5. Crear Componente Badge de Cliente

**Archivo:** `frontend/src/components/clientes/ClienteBadge.tsx`

```typescript
import { Badge } from '@/components/ui/badge';
import { BadgeCliente } from '@/types/cliente';
import { Crown, Star, Sparkles } from 'lucide-react';

interface ClienteBadgeProps {
  badge: BadgeCliente;
  size?: 'sm' | 'md' | 'lg';
}

export function ClienteBadge({ badge, size = 'md' }: ClienteBadgeProps) {
  const config = {
    VIP: {
      label: 'VIP',
      variant: 'default' as const,
      icon: Crown,
      className: 'bg-purple-600 text-white hover:bg-purple-700',
    },
    FRECUENTE: {
      label: 'Frecuente',
      variant: 'secondary' as const,
      icon: Star,
      className: 'bg-blue-600 text-white hover:bg-blue-700',
    },
    NUEVO: {
      label: 'Nuevo',
      variant: 'outline' as const,
      icon: Sparkles,
      className: 'bg-green-50 text-green-700 border-green-300',
    },
  };

  const { label, icon: Icon, className } = config[badge];
  const iconSize = size === 'sm' ? 12 : size === 'md' ? 14 : 16;

  return (
    <Badge className={`${className} gap-1`}>
      <Icon size={iconSize} />
      <span>{label}</span>
    </Badge>
  );
}
```

### 6. Crear Componente de Búsqueda de Clientes

**Archivo:** `frontend/src/components/clientes/ClienteSearch.tsx`

```typescript
import { useState, useEffect } from 'react';
import { Search } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { useClienteStore } from '@/stores/clienteStore';
import { useDebounce } from '@/hooks/useDebounce';

export function ClienteSearch() {
  const [searchTerm, setSearchTerm] = useState('');
  const debouncedSearchTerm = useDebounce(searchTerm, 500);
  const { fetchClientes } = useClienteStore();

  useEffect(() => {
    fetchClientes({ search: debouncedSearchTerm, page: 1 });
  }, [debouncedSearchTerm, fetchClientes]);

  return (
    <div className="relative">
      <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
      <Input
        type="text"
        placeholder="Buscar por nombre, teléfono o email..."
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
        className="pl-10 pr-4"
      />
    </div>
  );
}
```

**Crear hook de debounce:**

**Archivo:** `frontend/src/hooks/useDebounce.ts`

```typescript
import { useState, useEffect } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}
```

### 7. Crear Lista de Clientes

**Archivo:** `frontend/src/components/clientes/ClienteList.tsx`

```typescript
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Skeleton } from '@/components/ui/skeleton';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Phone, Mail, MapPin, Eye } from 'lucide-react';
import { useClienteStore } from '@/stores/clienteStore';
import { ClienteBadge } from './ClienteBadge';
import { formatCurrency } from '@/lib/utils';

export function ClienteList() {
  const navigate = useNavigate();
  const { clientes, isLoading, error, pagination, fetchClientes } = useClienteStore();

  useEffect(() => {
    fetchClientes();
  }, [fetchClientes]);

  if (isLoading && clientes.length === 0) {
    return (
      <div className="space-y-4">
        {[1, 2, 3].map((i) => (
          <Card key={i}>
            <CardContent className="p-6">
              <Skeleton className="h-20 w-full" />
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }

  if (error) {
    return (
      <Alert variant="destructive">
        <AlertDescription>{error}</AlertDescription>
      </Alert>
    );
  }

  if (clientes.length === 0) {
    return (
      <Card>
        <CardContent className="p-12 text-center">
          <p className="text-gray-500">No se encontraron clientes</p>
        </CardContent>
      </Card>
    );
  }

  return (
    <div className="space-y-4">
      {clientes.map((cliente: any) => (
        <Card 
          key={cliente.id} 
          className="hover:shadow-md transition-shadow cursor-pointer"
          onClick={() => navigate(`/clientes/${cliente.id}`)}
        >
          <CardContent className="p-6">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="flex items-center gap-3 mb-2">
                  <h3 className="text-lg font-semibold">
                    {cliente.nombre} {cliente.apellido}
                  </h3>
                  <ClienteBadge badge={cliente.estadisticas.badge} />
                </div>
                
                <div className="grid grid-cols-2 gap-4 text-sm text-gray-600">
                  <div className="flex items-center gap-2">
                    <Phone size={16} />
                    <span>{cliente.telefono}</span>
                  </div>
                  
                  {cliente.email && (
                    <div className="flex items-center gap-2">
                      <Mail size={16} />
                      <span>{cliente.email}</span>
                    </div>
                  )}
                  
                  {cliente.direccion && (
                    <div className="flex items-center gap-2">
                      <MapPin size={16} />
                      <span className="truncate">{cliente.direccion}</span>
                    </div>
                  )}
                </div>
                
                <div className="mt-4 flex gap-6 text-sm">
                  <div>
                    <span className="text-gray-500">Órdenes: </span>
                    <span className="font-semibold">{cliente.estadisticas.totalOrdenes}</span>
                  </div>
                  <div>
                    <span className="text-gray-500">Total gastado: </span>
                    <span className="font-semibold">
                      {formatCurrency(cliente.estadisticas.totalGastado)}
                    </span>
                  </div>
                  <div>
                    <span className="text-gray-500">Ticket promedio: </span>
                    <span className="font-semibold">
                      {formatCurrency(cliente.estadisticas.ticketPromedio)}
                    </span>
                  </div>
                </div>
                
                {cliente.estadisticas.adeudoPendiente > 0 && (
                  <div className="mt-3">
                    <Alert variant="destructive" className="py-2">
                      <AlertDescription className="text-sm">
                        Adeudo pendiente: {formatCurrency(cliente.estadisticas.adeudoPendiente)}
                      </AlertDescription>
                    </Alert>
                  </div>
                )}
              </div>
              
              <Button variant="outline" size="sm" className="ml-4">
                <Eye size={16} className="mr-2" />
                Ver perfil
              </Button>
            </div>
          </CardContent>
        </Card>
      ))}
      
      {/* Paginación */}
      {pagination.totalPages > 1 && (
        <div className="flex justify-center gap-2 mt-6">
          <Button
            variant="outline"
            disabled={pagination.page === 1}
            onClick={() => fetchClientes({ page: pagination.page - 1 })}
          >
            Anterior
          </Button>
          <span className="px-4 py-2 text-sm">
            Página {pagination.page} de {pagination.totalPages}
          </span>
          <Button
            variant="outline"
            disabled={pagination.page === pagination.totalPages}
            onClick={() => fetchClientes({ page: pagination.page + 1 })}
          >
            Siguiente
          </Button>
        </div>
      )}
    </div>
  );
}
```

### 8. Crear Timeline de Reparaciones

**Archivo:** `frontend/src/components/clientes/ClienteTimeline.tsx`

```typescript
import { format } from 'date-fns';
import { es } from 'date-fns/locale';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Clock, Package, CheckCircle, XCircle } from 'lucide-react';
import { formatCurrency } from '@/lib/utils';

interface Orden {
  id: string;
  folio: string;
  estado: string;
  costoTotal: number;
  fechaIngreso: string;
  fechaRealEntrega?: string;
  equipo: {
    marca: string;
    modelo: string;
  };
  problemaReportado: string;
}

interface ClienteTimelineProps {
  ordenes: Orden[];
}

export function ClienteTimeline({ ordenes }: ClienteTimelineProps) {
  if (ordenes.length === 0) {
    return (
      <Card>
        <CardContent className="p-8 text-center text-gray-500">
          Este cliente no tiene órdenes registradas
        </CardContent>
      </Card>
    );
  }

  const getEstadoIcon = (estado: string) => {
    switch (estado) {
      case 'ENTREGADO':
        return <CheckCircle className="text-green-500" size={20} />;
      case 'CANCELADO':
        return <XCircle className="text-red-500" size={20} />;
      case 'EN_REPARACION':
      case 'EN_DIAGNOSTICO':
        return <Clock className="text-blue-500" size={20} />;
      default:
        return <Package className="text-gray-500" size={20} />;
    }
  };

  const getEstadoBadge = (estado: string) => {
    const variants: Record<string, any> = {
      RECIBIDO: { variant: 'secondary', label: 'Recibido' },
      EN_DIAGNOSTICO: { variant: 'default', label: 'En Diagnóstico' },
      EN_REPARACION: { variant: 'default', label: 'En Reparación' },
      ESPERANDO_REFACCION: { variant: 'default', label: 'Esperando Refacción' },
      TERMINADO: { variant: 'default', label: 'Terminado' },
      ENTREGADO: { variant: 'default', label: 'Entregado' },
      CANCELADO: { variant: 'destructive', label: 'Cancelado' },
    };

    const config = variants[estado] || { variant: 'secondary', label: estado };
    return <Badge variant={config.variant}>{config.label}</Badge>;
  };

  return (
    <div className="space-y-4">
      {ordenes.map((orden, index) => (
        <Card key={orden.id}>
          <CardContent className="p-6">
            <div className="flex items-start gap-4">
              {/* Línea vertical del timeline */}
              <div className="relative">
                {getEstadoIcon(orden.estado)}
                {index < ordenes.length - 1 && (
                  <div className="absolute left-1/2 top-6 w-0.5 h-full bg-gray-200 -translate-x-1/2" />
                )}
              </div>
              
              {/* Contenido */}
              <div className="flex-1">
                <div className="flex items-start justify-between mb-2">
                  <div>
                    <h4 className="font-semibold text-lg">{orden.folio}</h4>
                    <p className="text-sm text-gray-500">
                      {orden.equipo.marca} {orden.equipo.modelo}
                    </p>
                  </div>
                  {getEstadoBadge(orden.estado)}
                </div>
                
                <p className="text-sm text-gray-700 mb-3">
                  {orden.problemaReportado}
                </p>
                
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span className="text-gray-500">Fecha de ingreso: </span>
                    <span className="font-medium">
                      {format(new Date(orden.fechaIngreso), 'dd MMM yyyy', { locale: es })}
                    </span>
                  </div>
                  
                  {orden.fechaRealEntrega && (
                    <div>
                      <span className="text-gray-500">Fecha de entrega: </span>
                      <span className="font-medium">
                        {format(new Date(orden.fechaRealEntrega), 'dd MMM yyyy', { locale: es })}
                      </span>
                    </div>
                  )}
                  
                  <div>
                    <span className="text-gray-500">Costo: </span>
                    <span className="font-semibold">
                      {formatCurrency(orden.costoTotal)}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
```

### 9. Crear Perfil Completo del Cliente

**Archivo:** `frontend/src/pages/ClienteDetalle.tsx`

```typescript
import { useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Separator } from '@/components/ui/separator';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { Skeleton } from '@/components/ui/skeleton';
import { 
  ArrowLeft, 
  Phone, 
  Mail, 
  MapPin, 
  Edit, 
  TrendingUp,
  DollarSign,
  ShoppingCart,
  Calendar,
  AlertTriangle
} from 'lucide-react';
import { useClienteStore } from '@/stores/clienteStore';
import { ClienteBadge } from '@/components/clientes/ClienteBadge';
import { ClienteTimeline } from '@/components/clientes/ClienteTimeline';
import { formatCurrency } from '@/lib/utils';

export function ClienteDetalle() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { clienteSeleccionado, isLoading, error, fetchClienteById } = useClienteStore();

  useEffect(() => {
    if (id) {
      fetchClienteById(id);
    }
  }, [id, fetchClienteById]);

  if (isLoading) {
    return (
      <div className="space-y-6">
        <Skeleton className="h-10 w-64" />
        <Skeleton className="h-64 w-full" />
        <Skeleton className="h-96 w-full" />
      </div>
    );
  }

  if (error || !clienteSeleccionado) {
    return (
      <Alert variant="destructive">
        <AlertDescription>{error || 'Cliente no encontrado'}</AlertDescription>
      </Alert>
    );
  }

  const cliente = clienteSeleccionado;
  const stats = cliente.estadisticas;
  const iniciales = `${cliente.nombre[0]}${cliente.apellido[0]}`.toUpperCase();

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <Button variant="ghost" size="sm" onClick={() => navigate('/clientes')}>
            <ArrowLeft size={20} />
          </Button>
          <h1 className="text-3xl font-bold">Perfil del Cliente</h1>
        </div>
        <Button onClick={() => navigate(`/clientes/${id}/editar`)}>
          <Edit size={16} className="mr-2" />
          Editar
        </Button>
      </div>

      {/* Alertas */}
      {cliente.alertas && cliente.alertas.length > 0 && (
        <div className="space-y-2">
          {cliente.alertas.map((alerta, index) => (
            <Alert key={index} variant={alerta.tipo === 'ADEUDO' ? 'destructive' : 'default'}>
              <AlertTriangle size={16} />
              <AlertDescription>{alerta.mensaje}</AlertDescription>
            </Alert>
          ))}
        </div>
      )}

      {/* Información del Cliente */}
      <Card>
        <CardContent className="p-6">
          <div className="flex items-start gap-6">
            <Avatar className="h-24 w-24">
              <AvatarFallback className="text-2xl">{iniciales}</AvatarFallback>
            </Avatar>
            
            <div className="flex-1">
              <div className="flex items-center gap-3 mb-4">
                <h2 className="text-2xl font-bold">
                  {cliente.nombre} {cliente.apellido}
                </h2>
                <ClienteBadge badge={stats.badge} size="lg" />
              </div>
              
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div className="flex items-center gap-2">
                  <Phone size={16} className="text-gray-400" />
                  <span>{cliente.telefono}</span>
                </div>
                
                {cliente.telefonoAlterno && (
                  <div className="flex items-center gap-2">
                    <Phone size={16} className="text-gray-400" />
                    <span>{cliente.telefonoAlterno}</span>
                  </div>
                )}
                
                {cliente.email && (
                  <div className="flex items-center gap-2">
                    <Mail size={16} className="text-gray-400" />
                    <span>{cliente.email}</span>
                  </div>
                )}
                
                {cliente.direccion && (
                  <div className="flex items-center gap-2">
                    <MapPin size={16} className="text-gray-400" />
                    <span>{cliente.direccion}</span>
                  </div>
                )}
              </div>
              
              {cliente.notas && (
                <>
                  <Separator className="my-4" />
                  <div>
                    <h4 className="font-semibold mb-2">Notas:</h4>
                    <p className="text-sm text-gray-600">{cliente.notas}</p>
                  </div>
                </>
              )}
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Estadísticas */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-500">Total Órdenes</p>
                <p className="text-2xl font-bold">{stats.totalOrdenes}</p>
              </div>
              <ShoppingCart className="text-blue-500" size={32} />
            </div>
          </CardContent>
        </Card>
        
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-500">Total Gastado</p>
                <p className="text-2xl font-bold">{formatCurrency(stats.totalGastado)}</p>
              </div>
              <DollarSign className="text-green-500" size={32} />
            </div>
          </CardContent>
        </Card>
        
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-500">Ticket Promedio</p>
                <p className="text-2xl font-bold">{formatCurrency(stats.ticketPromedio)}</p>
              </div>
              <TrendingUp className="text-purple-500" size={32} />
            </div>
          </CardContent>
        </Card>
        
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-500">Frecuencia (órdenes/mes)</p>
                <p className="text-2xl font-bold">{stats.frecuenciaVisitas}</p>
              </div>
              <Calendar className="text-orange-500" size={32} />
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Tabs */}
      <Tabs defaultValue="timeline" className="w-full">
        <TabsList>
          <TabsTrigger value="timeline">Timeline de Reparaciones</TabsTrigger>
          <TabsTrigger value="equipos">Equipos</TabsTrigger>
          <TabsTrigger value="ventas">Ventas</TabsTrigger>
        </TabsList>
        
        <TabsContent value="timeline" className="mt-6">
          <ClienteTimeline ordenes={cliente.ordenes || []} />
        </TabsContent>
        
        <TabsContent value="equipos" className="mt-6">
          <Card>
            <CardHeader>
              <CardTitle>Equipos Registrados</CardTitle>
            </CardHeader>
            <CardContent>
              {cliente.equipos && cliente.equipos.length > 0 ? (
                <div className="space-y-3">
                  {cliente.equipos.map((equipo: any) => (
                    <div key={equipo.id} className="p-4 border rounded-lg">
                      <div className="font-semibold">
                        {equipo.marca} {equipo.modelo}
                      </div>
                      {equipo.imei && (
                        <div className="text-sm text-gray-600">IMEI: {equipo.imei}</div>
                      )}
                      {equipo.color && (
                        <div className="text-sm text-gray-600">Color: {equipo.color}</div>
                      )}
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-gray-500 text-center py-8">
                  No hay equipos registrados
                </p>
              )}
            </CardContent>
          </Card>
        </TabsContent>
        
        <TabsContent value="ventas" className="mt-6">
          <Card>
            <CardHeader>
              <CardTitle>Historial de Ventas</CardTitle>
            </CardHeader>
            <CardContent>
              {cliente.ventas && cliente.ventas.length > 0 ? (
                <div className="space-y-3">
                  {cliente.ventas.map((venta: any) => (
                    <div key={venta.id} className="p-4 border rounded-lg">
                      <div className="flex justify-between">
                        <div className="font-semibold">{venta.folio}</div>
                        <div className="font-bold">{formatCurrency(venta.total)}</div>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-gray-500 text-center py-8">
                  No hay ventas registradas
                </p>
              )}
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
}
```

### 10. Crear UI para Detección y Fusión de Duplicados

**Archivo:** `frontend/src/components/clientes/DuplicadosManager.tsx`

```typescript
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Skeleton } from '@/components/ui/skeleton';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Radio, RadioGroup } from '@/components/ui/radio-group';
import { AlertTriangle, Users, ArrowRight } from 'lucide-react';
import { clienteService } from '@/services/clienteService';
import { DuplicadoCliente } from '@/types/cliente';

export function DuplicadosManager() {
  const [duplicados, setDuplicados] = useState<DuplicadoCliente[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedDup, setSelectedDup] = useState<DuplicadoCliente | null>(null);
  const [clientePrincipal, setClientePrincipal] = useState<string>('');
  const [isFusing, setIsFusing] = useState(false);

  useEffect(() => {
    loadDuplicados();
  }, []);

  const loadDuplicados = async () => {
    setIsLoading(true);
    try {
      const data = await clienteService.detectarDuplicados();
      setDuplicados(data);
    } catch (err: any) {
      setError(err.message);
    } finally {
      setIsLoading(false);
    }
  };

  const handleFusionar = async () => {
    if (!selectedDup || !clientePrincipal) return;

    const clienteDuplicado =
      clientePrincipal === selectedDup.cliente1.id
        ? selectedDup.cliente2.id
        : selectedDup.cliente1.id;

    setIsFusing(true);
    try {
      await clienteService.fusionarClientes(clientePrincipal, clienteDuplicado);
      setSelectedDup(null);
      loadDuplicados(); // Recargar lista
    } catch (err: any) {
      setError(err.message);
    } finally {
      setIsFusing(false);
    }
  };

  if (isLoading) {
    return (
      <div className="space-y-4">
        <Skeleton className="h-32 w-full" />
        <Skeleton className="h-32 w-full" />
      </div>
    );
  }

  if (error) {
    return (
      <Alert variant="destructive">
        <AlertDescription>{error}</AlertDescription>
      </Alert>
    );
  }

  if (duplicados.length === 0) {
    return (
      <Card>
        <CardContent className="p-12 text-center">
          <Users size={48} className="mx-auto mb-4 text-gray-400" />
          <p className="text-gray-500">No se encontraron clientes duplicados</p>
        </CardContent>
      </Card>
    );
  }

  return (
    <>
      <div className="space-y-4">
        <Alert>
          <AlertTriangle size={16} />
          <AlertDescription>
            Se encontraron {duplicados.length} posible(s) duplicado(s). Revisa y fusiona si es necesario.
          </AlertDescription>
        </Alert>

        {duplicados.map((dup, index) => (
          <Card key={index}>
            <CardContent className="p-6">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-6 flex-1">
                  {/* Cliente 1 */}
                  <div className="flex-1">
                    <h4 className="font-semibold">{dup.cliente1.nombre}</h4>
                    <p className="text-sm text-gray-600">{dup.cliente1.telefono}</p>
                  </div>

                  {/* Flecha */}
                  <ArrowRight size={24} className="text-gray-400" />

                  {/* Cliente 2 */}
                  <div className="flex-1">
                    <h4 className="font-semibold">{dup.cliente2.nombre}</h4>
                    <p className="text-sm text-gray-600">{dup.cliente2.telefono}</p>
                  </div>
                </div>

                {/* Información de similitud */}
                <div className="flex items-center gap-4 ml-6">
                  <div className="text-sm">
                    <div>Similitud: {dup.similitudNombre}%</div>
                    {dup.telefonosIguales && (
                      <div className="text-red-600 font-medium">Mismo teléfono</div>
                    )}
                  </div>
                  <Button onClick={() => setSelectedDup(dup)}>
                    Fusionar
                  </Button>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Dialog de Fusión */}
      <Dialog open={!!selectedDup} onOpenChange={() => setSelectedDup(null)}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Fusionar Clientes Duplicados</DialogTitle>
            <DialogDescription>
              Selecciona cuál será el cliente principal. Todos los datos del cliente duplicado
              se transferirán al cliente principal y el duplicado será eliminado.
            </DialogDescription>
          </DialogHeader>

          {selectedDup && (
            <RadioGroup value={clientePrincipal} onValueChange={setClientePrincipal}>
              <div className="space-y-4">
                <div
                  className={`p-4 border rounded-lg cursor-pointer ${
                    clientePrincipal === selectedDup.cliente1.id
                      ? 'border-blue-500 bg-blue-50'
                      : ''
                  }`}
                  onClick={() => setClientePrincipal(selectedDup.cliente1.id)}
                >
                  <div className="font-semibold">{selectedDup.cliente1.nombre}</div>
                  <div className="text-sm text-gray-600">{selectedDup.cliente1.telefono}</div>
                </div>

                <div
                  className={`p-4 border rounded-lg cursor-pointer ${
                    clientePrincipal === selectedDup.cliente2.id
                      ? 'border-blue-500 bg-blue-50'
                      : ''
                  }`}
                  onClick={() => setClientePrincipal(selectedDup.cliente2.id)}
                >
                  <div className="font-semibold">{selectedDup.cliente2.nombre}</div>
                  <div className="text-sm text-gray-600">{selectedDup.cliente2.telefono}</div>
                </div>
              </div>
            </RadioGroup>
          )}

          <DialogFooter>
            <Button variant="outline" onClick={() => setSelectedDup(null)}>
              Cancelar
            </Button>
            <Button
              onClick={handleFusionar}
              disabled={!clientePrincipal || isFusing}
            >
              {isFusing ? 'Fusionando...' : 'Fusionar'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </>
  );
}
```

### 11. Crear Helper de Formato

**Archivo:** `frontend/src/lib/utils.ts` (agregar función)

```typescript
export function formatCurrency(amount: number): string {
  return new Intl.NumberFormat('es-MX', {
    style: 'currency',
    currency: 'MXN',
  }).format(amount);
}
```

### 12. Configurar Rutas en React Router

**Archivo:** `frontend/src/App.tsx` (o donde configures las rutas)

```typescript
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import ClientesList from './pages/ClientesList';
import ClienteDetalle from './pages/ClienteDetalle';
import DuplicadosPage from './pages/DuplicadosPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/clientes" element={<ClientesList />} />
        <Route path="/clientes/:id" element={<ClienteDetalle />} />
        <Route path="/clientes/duplicados" element={<DuplicadosPage />} />
        {/* ... más rutas */}
      </Routes>
    </BrowserRouter>
  );
}
```

## Criterios de Éxito

✅ **Lista de Clientes:**
  - Búsqueda instantánea con debounce ✅
  - Cards con información resumida ✅
  - Badges visuales (VIP/Frecuente/Nuevo) ✅
  - Paginación funcional ✅
  - Responsive design ✅

✅ **Perfil del Cliente:**
  - Información completa y organizada ✅
  - Estadísticas en cards visualmente atractivas ✅
  - Alertas destacadas (adeudos, órdenes pendientes) ✅
  - Tabs para organizar información ✅

✅ **Timeline de Reparaciones:**
  - Línea visual de tiempo ✅
  - Iconos por estado ✅
  - Información resumida de cada orden ✅
  - Formato de fechas en español ✅

✅ **Búsqueda de Clientes:**
  - Componente reutilizable ✅
  - Búsqueda en tiempo real ✅
  - Indicador visual de búsqueda ✅

✅ **Detección de Duplicados:**
  - UI clara para comparar clientes ✅
  - Indicadores de similitud ✅
  - Proceso de fusión guiado ✅

✅ **State Management:**
  - Zustand store configurado ✅
  - Manejo de loading states ✅
  - Manejo de errores ✅

## Comandos de Verificación

```bash
# Instalar dependencias
npm install

# Iniciar desarrollo
npm run dev

# Build para producción
npm run build

# Preview build
npm run preview
```

## Screenshots Esperados

Crear screenshots de:
1. Lista de clientes con badges
2. Perfil completo del cliente
3. Timeline de reparaciones
4. Componente de búsqueda
5. UI de fusión de duplicados

## Problemas Comunes y Soluciones

**Error: "Cannot find module '@/components/ui/..."**
- Solución: Verificar que shadcn/ui esté configurado correctamente y los componentes estén instalados.

**Búsqueda no funciona**
- Solución: Verificar que el hook useDebounce esté implementado correctamente.

**Badges no se muestran con colores correctos**
- Solución: Verificar configuración de Tailwind CSS y que las clases estén en la lista de safelist.

**Timeline no muestra la línea vertical**
- Solución: Verificar que los estilos CSS estén aplicándose correctamente.

## Entregables

1. ✅ `frontend/src/types/cliente.ts` - Tipos TypeScript
2. ✅ `frontend/src/services/clienteService.ts` - API service
3. ✅ `frontend/src/stores/clienteStore.ts` - Zustand store
4. ✅ `frontend/src/components/clientes/ClienteBadge.tsx` - Badge component
5. ✅ `frontend/src/components/clientes/ClienteSearch.tsx` - Search component
6. ✅ `frontend/src/components/clientes/ClienteList.tsx` - List component
7. ✅ `frontend/src/components/clientes/ClienteTimeline.tsx` - Timeline component
8. ✅ `frontend/src/components/clientes/DuplicadosManager.tsx` - Duplicados UI
9. ✅ `frontend/src/pages/ClienteDetalle.tsx` - Detail page
10. ✅ `frontend/src/hooks/useDebounce.ts` - Debounce hook
11. ✅ Rutas configuradas en React Router

## Próximos Pasos

Una vez completado este módulo, podrás:
- Integrar con los módulos de órdenes y presupuestos
- Agregar funcionalidad de crear/editar clientes con formularios
- Implementar exportación de datos
- Agregar gráficas de estadísticas

## Referencias

- React: https://react.dev/
- Tailwind CSS: https://tailwindcss.com/
- shadcn/ui: https://ui.shadcn.com/
- Zustand: https://github.com/pmndrs/zustand
- React Hook Form: https://react-hook-form.com/
- date-fns: https://date-fns.org/
